# TLS all you need to know
## Cert
### Make directories
```bash
mkdir -p /etc/ssl/{private,certs,requests,CA}
cd /etc/ssl
```
## CA Signed Certificate
### Create Priv Cert
Create de private certificate with a password for the www.securejump.com site.
```bash
openssl genrsa -des3 -out private/www_securejump_com.key.secure 2048
chmod 600 private/www_securejump_com.key.secure
```
Options
* `-des3` encrypt the generated key with DES in ede cbc mode (168 bit key)
* `-out private/www_securejump_com.key.secure` output the key to
* `2048` numbits

### Create Certificate Sign Request CSR
```bash
openssl req -new -sha256 -key private/www_securejump_com.key.secure -out requests/www_securejump_com.csr
```
Options
* `-new` new request.
* `-sha256` Digest to sign with
* `-key private/www_securejump_com.key` use the private key contained in file
* `-out certs/www_securejump_com.csr` output file

### Self signed certificate
**Optional**
```bash
openssl x509 -req -days 365 -in requests/www_securejump_com.csr -signkey private/www_securejump_com.key.secure -out certs/www_securejump_com.crt
```
Options
* `-req` input is a certificate request, sign and output.
* `-days 365` How long till expiry of a signed certificate - def 30 days
* `-in requests/www_securejump_com.csr` input file - default stdin
* `-signkey private/www_securejump_com.key.secure` self sign cert with arg
* `-out certs/www_securejump_com.crt` output file - default stdout

### Send csr file to CA for signing
Place the signed certificate in `certs` folder
### CA files
```bash
cat COMODORSADomainValidationSecureServerCA.crt COMODORSAAddTrustCA.crt AddTrustExternalCARoot.crt > certs/www_securejump_com.ca-bundle
```
### Bundle .pfx
To create .pfx or .p12, do this:
```bash
openssl pkcs12 -export -in certs/www_securejump_com.crt -inkey private/www_securejump_com.key.secure -certfile certs/www_securejump_com.ca-bundle -out www_securejump_com.pfx
```
Options
* `-export` output PKCS12 file
* `-in certs/www_securejump_com.crt` input file name
* `-inkey private/www_securejump_com.key.secure` private key if not infile
* `-certfile certs/www_securejump_com.ca-bundle` add all certs in www_securejump_com.ca-bundle
* `-out www_securejump_com.pfx` output filename

And choose an export password.
## Self Signed Certificate without Certificate Sign Request
### Create Priv Cert and Pub Cert
```bash
openssl req -new -x509 -sha256 -days 365 -newkey rsa:2048 -keyout private/www_securejump_com.key -out certs/www_securejump_com.crt
```
Options
* `-new` new request.
* `-x509` output a x509 structure instead of a cert. req.
* `-sha256` Digest to sign with
* `-days 365` number of days a certificate generated by -x509 is valid for.
* `-newkey rsa:2048` generate a new RSA key of 2048 bits in size
* `-keyout private/www_securejump_com.key` file to send the key to
* `-out certs/www_securejump_com.crt` output file

## Client cert
Same process
```bash
openssl genrsa -des3 -out private/firefox.key.secure 2048
chmod 600 private/firefox.key.secure
openssl req -new -sha256 -key private/firefox.key.secure -out requests/firefox.csr
openssl x509 -req -days 365 -in requests/firefox.csr -signkey private/firefox.key.secure -out certs/firefox.crt
```
